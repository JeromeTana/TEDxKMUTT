---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import { getLangFromUrl } from "@/i18n/utils";

import Button from "@/components/Button.astro";
import EventCard from "@/components/EventCard.astro";
import ContactForm from "@/components/ContactForm.astro";
import BlogItem from "@/components/BlogItem.astro";
import VisionCard from "@/components/VisionCard.astro";
import Container from "@/components/Container.astro";
import Section from "@/components/Section.astro";

import Layout from "@/layouts/Layout.astro";

import QuoteL from "@/assets/images/Quote_l.png";
import QuoteR from "@/assets/images/Quote_r.png";
import Preparation from "@/assets/images/backgrounds/Prepare.jpg";
import StageImg from "@/assets/images/backgrounds/Stage.jpg";
import StairImg from "@/assets/images/backgrounds/Stair.jpg";
import Audience from "@/assets/images/backgrounds/Audience.jpg";
import EventDecoreImg from "@/assets/images/wave-line-1.png";
import BlogDecoreImg from "@/assets/images/wave-line-2.png";
import TedxDecoreImg from "@/assets/images/wave-line-3.png";
import QuoteDecore from "@/assets/images/wave-line-4.png";
import TedxImg from "@/assets/images/Tedx.png";
import EngBuildImg from "@/assets/images/backgrounds/KMUTT_Eng_Building.png";
import SwiperTalkCard from "@/components/SwiperTalkCard.astro";

const allEvents = await getCollection("event");

const lang = getLangFromUrl(Astro.url);
const allReadings = await getCollection("read");

const allAuthors = await getCollection("author");
const authorMap = Object.fromEntries(
    allAuthors.map((author) => [author.id, author.data])
);
---

<Layout title="TEDx KMUTT">
    <div class="space-y-80 overflow-hidden">
        <div
            class="relative bg-gray-400 flex justify-center items-center h-[60vh] m-2 p-8 rounded-3xl overflow-clip"
        >
            <img
                src={EngBuildImg.src}
                alt="Engineering Building"
                class="absolute top-0 left-0 w-full h-full inset-0 object-cover"
            />
            <div class="absolute bg-black opacity-60 w-full h-full top-0"></div>

            <div class="max-w-screen-md text-center z-10">
                <p
                    data-aos="fade-up"
                    class="text-primary-500 font-bold mb-3 md:mb-6"
                >
                    Ideas worth spreading
                </p>
                <div class="mb-11">
                    <h1
                        data-aos="fade-up"
                        data-aos-delay="200"
                        class="text-4xl md:text-6xl font-semibold mb-2"
                    >
                        Reimagining the Future, <br />One Talk at a Time
                    </h1>
                    <p
                        data-aos="fade-up"
                        data-aos-delay="400"
                        class="text-lg md:text-xl"
                    >
                        Experience thought-provoking talks from visionary
                        thinkers and innovators at King Mongkut's University of
                        Technology Thonburi
                    </p>
                </div>
                <div
                    data-aos="fade-up"
                    data-aos-delay="600"
                    class="flex justify-center flex-wrap gap-2"
                >
                    <Button href={`/${lang}/watch`}>
                        <Icon name="mdi:play" class="mr-2" />
                        Watch talks
                    </Button>
                    <Button href={`/${lang}/read`} variant="accent">
                        <Icon
                            name="mdi:book-open-variant-outline"
                            class="mr-2"
                        />
                        Read blogs
                    </Button>
                </div>
            </div>
        </div>

        <div class="relative !mt-48 !mb-96 py-32 text-center">
            <div class="relative max-w-screen-lg m-auto">
                <img
                    src={QuoteL.src}
                    data-aos="fade-up"
                    alt="Quote_L"
                    class="absolute bottom-14 md:bottom-16 left-0 ml-2 w-12 md:w-24"
                />
                <p
                    data-aos="fade-up"
                    data-aos-delay="200"
                    data-aos-duration="700"
                    class="text-4xl md:text-6xl font-bold"
                >
                    Ideas worth spreading
                </p>
                <img
                    src={QuoteR.src}
                    data-aos="fade-up"
                    alt="Quote_R"
                    class="absolute top-16 right-0 mr-2 w-12 md:w-24"
                />
            </div>
            <img
                src={QuoteDecore.src}
                alt=""
                class="absolute top-1/2 -translate-y-2/3 md:-translate-y-1/3 left-1/2 md:left-0 max-w-screen-2xl md:max-w-full -translate-x-1/2 md:translate-x-0 md:w-full -z-10"
            />
        </div>

        <Container>
            <div
                data-aos="fade-up"
                data-aos-duration="1000"
                class="flex flex-col md:flex-row gap-8"
            >
                <img
                    src={Preparation.src}
                    alt="TEDx Preparation"
                    class="md:w-1/2 aspect-video rounded-xl object-cover"
                />
                <Section
                    tag="About us"
                    description=`TEDx KMUTT brings cutting-edge ideas to King Mongkut's University of Technology Thonburi. We showcase innovative thinkers from our community and beyond, fostering intellectual growth and inspiration`
                >
                    <div slot="headline">
                        Ideas in <span class="c-underline">Action</span> at KMUTT
                    </div>
                    <Button href={`/${lang}/about`}>Getting to know us</Button>
                </Section>
            </div>
        </Container>

        <Container>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                <VisionCard
                    data-aos="fade-up"
                    thumbnail={Audience}
                    text="Innovation"
                />
                <VisionCard
                    data-aos="fade-up"
                    data-aos-delay="200"
                    thumbnail={StairImg}
                    text="Collaboration"
                />
                <VisionCard
                    data-aos="fade-up"
                    data-aos-delay="400"
                    thumbnail={StageImg}
                    text="Impact"
                />
            </div>
        </Container>
        <div class="relative">
            <Container>
                <div
                    data-aos="fade-up"
                    data-aos-duration="1000"
                    class="flex flex-col justify-between gap-12 md:flex-row"
                >
                    <Section
                        tag="TEDx"
                        description=`In the spirit of discovering and spreading ideas, TED has created a program called TEDx.

                            TEDx is a program of local, self-organized events that bring people together to share a TED-like experience. Our event is called TEDx[name],
                            
                            where x = independently organized TED event. At our TEDx[name] event,
                            
                            TED Talks video and live speakers will combine to spark deep discussion and connection in a small group. The TED Conference provides general guidance for the TEDx program,
                            
                            but individual TEDx events, including ours, are self-organized.`
                    >
                        <div slot="headline">
                            What is <span class="c-underline">TEDx?</span>
                        </div>
                        <Button
                            href="https://www.ted.com/about/programs-initiatives/tedx-program"
                            target="_blank"
                        >
                            Explore more of TEDx &nbsp;
                            <Icon name="mdi:open-in-new" />
                        </Button>
                    </Section>
                    <img
                        src={TedxImg.src}
                        alt="TEDx"
                        class="aspect-video md:aspect-auto md:w-1/2 object-cover border border-gray-500 rounded-2xl duration-200 shadow-[0_0_2rem_0_rgba(0,0,0,0.3)] hover:shadow-primary-600"
                    />
                </div>
            </Container>
            <img
                src={TedxDecoreImg.src}
                alt=""
                class="absolute top-0 -translate-y-2/3 md:w-full -z-10 left-1/2 md:left-0 -translate-x-1/2 max-w-screen-2xl md:max-w-full md:translate-x-0"
            />
        </div>

        <div class="relative">
            <Container>
                <Section
                    tag="Our past journeys"
                    description=`Explore our previous events that have illuminated groundbreaking research, visionary projects, and transformative ideas born at KMUTT and beyond`
                    style="md:text-center mb-16"
                >
                    <div slot="headline">
                        A <span class="c-underline">Legacy</span> of Inspiration
                    </div>
                </Section>
                <div
                    data-aos="fade-up"
                    data-aos-delay="200"
                    class="swiper-event flex gap-2"
                >
                    <div class="swiper-wrapper">
                        {
                            allEvents.map((event) => (
                                <EventCard
                                    data-aos="fade-up"
                                    event={event.data}
                                    className="swiper-slide"
                                />
                            ))
                        }
                    </div>
                    <div class="swiper-button-prev xl:-translate-x-28"></div>
                    <div class="swiper-button-next xl:translate-x-28"></div>
                </div>
            </Container>
            <img
                src={EventDecoreImg.src}
                alt=""
                class="absolute bottom-40 md:bottom-0 translate-y-1/2 md:w-full -z-10 left-1/2 md:left-0 -translate-x-1/2 max-w-screen-2xl md:max-w-full md:translate-x-0"
            />
        </div>
        <div class="bg-[#131313] py-32">
            <Container>
                <Section
                    tag="Highlighted talks"
                    description=`Watch standout presentations from KMUTT researchers, alumni, and invited experts that exemplify our commitment to advancing knowledge and technology`
                    style="md:text-center mb-16"
                >
                    <div slot="headline">
                        Ideas That <span class="c-underline">Resonate</span>
                    </div>
                </Section>
                <SwiperTalkCard />
                <div class="flex justify-end mt-8">
                    <Button href={`/${lang}/watch`}>All talks</Button>
                </div>
            </Container>
        </div>
        <div class="relative">
            <Container>
                <Section
                    tag="Read blogs"
                    description=`Delve deeper into TEDx KMUTT talks with expert analyses, speaker interviews, and explorations of how these ideas are shaping our future`
                    style="md:text-center"
                >
                    <div slot="headline">
                        <h2>
                            <span class="c-underline">Beyond</span> the Stage
                        </h2>
                    </div>
                </Section>
                <div
                    data-aos="fade-up"
                    data-aos-delay="200"
                    class="grid sm:grid-cols-2 lg:grid-cols-3 gap-y-12"
                >
                    {
                        allReadings.slice(0, 6).map((reading) => {
                            const author = authorMap[reading.data.author.id];
                            return (
                                <a href={`/${lang}/read/${reading.slug}`}>
                                    <BlogItem
                                        data-aos="fade-up"
                                        blog={reading}
                                        author={author}
                                    />
                                </a>
                            );
                        })
                    }
                </div>
                <div class="flex justify-end mt-8">
                    <Button href={`/${lang}/read`}>All blogs</Button>
                </div>
            </Container>
            <img
                src={BlogDecoreImg.src}
                alt=""
                class="absolute top-0 -translate-y-1/4 md:w-full -z-10 left-1/2 md:left-0 -translate-x-1/2 max-w-screen-2xl md:max-w-full md:translate-x-0"
            />
        </div>
        <ContactForm />
    </div>

    <style is:global>
        .c-underline {
            position: relative;
        }
        .c-underline::after {
            content: "";
            position: absolute;
            bottom: -16px;
            left: 0;
            height: 12px;
            width: 100%;
            border-top: solid 2px;
            border-color: #eb0028 transparent transparent transparent;
            border-radius: 50%;
            rotate: -2deg;
        }
        .swiper-container-free-mode > .swiper-wrapper {
            transition-timing-function: linear;
        }

        .swiper-button-next::after,
        .swiper-button-prev::after {
            color: white;
        }
    </style>
    <script>
        import Swiper from "swiper";
        import { Navigation, Pagination } from "swiper/modules";

        import AOS from "aos";
        import "aos/dist/aos.css";
        import "swiper/css";
        import "swiper/css/navigation";
        import "swiper/css/pagination";

        const swiperOptions = {
            modules: [Navigation, Pagination],
            slidesPerView: 1.1,
            spaceBetween: 10,
            speed: 1000,
            grabCursor: true,
            mousewheelControl: true,
            keyboardControl: true,
            breakpoints: {
                640: {
                    // slidesPerView: 2.3,
                },
                768: {
                    slidesPerView: 1.5,
                },
                1024: {
                    slidesPerView: 1.8,
                },
            },
            navigation: {
                nextEl: ".swiper-button-next",
                prevEl: ".swiper-button-prev",
            },
        };

        AOS.init({
            offset: 120,
            duration: 500,
            easing: "ease-in-out",
            once: true,
        });

        const swiper = new Swiper(".swiper-event", swiperOptions);
    </script>
</Layout>
