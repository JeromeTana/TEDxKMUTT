---
interface Props {
  blog: {
    thumbnail: {
      src: string;
      alt?: string;
    };
    categories: string[];
    title: string;
    author: {
      id: string;
    };
    pubDate: Date;
  };
  author: {
    name: string;
    avatar: {
      src: string;
      alt?: string;
    };
  };
    content: string;
};

const { blog, author, content } = Astro.props as Props;

function flattenMarkdown(markdownText: string) {
    return markdownText
        // Remove headers
        .replace(/^#{1,6}\s+/gm, "")
        // Remove bold and italic formatting
        .replace(/(\*\*|__)(.*?)\1/g, "$2")
        .replace(/(\*|_)(.*?)\1/g, "$2")
        // Remove strikethrough
        .replace(/~~(.*?)~~/g, "$1")
        // Remove links but keep text
        .replace(/\[([^\]]+)]\(([^)]+)\)/g, "$1")
        // Remove images but keep alt text
        .replace(/!\[([^\]]*)]\(([^)]+)\)/g, "$1")
        // Remove inline code
        .replace(/`([^`]+)`/g, "$1")
        // Remove code blocks
        .replace(/```[\s\S]*?```/g, "")
        // Remove horizontal lines
        .replace(/---+/g, "")
        // Remove lists and list markers
        .replace(/^\s*([-*+]|\d+\.)\s+/gm, "")
        // Remove blockquotes
        .replace(/^\s*>+/gm, "")
        // Remove extra whitespace and new lines
        .replace(/\n{2,}/g, "\n")
        .trim();
}

---

<div class="text-white p-4 rounded-lg space-y-3">
    <div class="relative rounded-2xl overflow-hidden">
        <img src={blog.thumbnail.src} alt={blog.thumbnail.alt} class="w-full h-52 object-cover" />
        <div class="absolute inset-0 bg-black opacity-50"></div>
    </div>
    <div class="flex items-center">

        {
            blog.categories.map((category) => (
                <span class="bg-[#46000C] mt-6 mb-2 text-red-600 rounded-full text-sm px-3 py-1 mr-2">{category.toUpperCase()}</span>
            ))
        }

    </div>
    <h2 class="text-2xl font-bold">{blog.title}</h2>
    <p class="text-gray-400 text-md line-clamp-2">{flattenMarkdown(content)}</p>
    <div class="flex items-center space-x-1 space-y-4">
        <img src={author.avatar.src} class="w-8 h-8 object-cover rounded-full mr-2" alt={`${author.name}'s avatar`} />
        <div class="text-sm">
            <p>{author.name}</p>
            <p class="text-xs text-gray-400">{blog.pubDate.toDateString()}</p>
        </div>
    </div>
</div>